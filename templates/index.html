{% extends 'base.html' %}
{% block title %}Main Menu{% endblock %}
{% block header %}
  <span>MainMenu</span>
{% endblock %}
{% block content %}
<section class="topics">
  <table id="topics-table">
    <thead>
      <tr>
        <th class="p5">Topic</th>
        <th class="p5">Stats and Progress</th>
      </tr>
    </thead>
    <tbody>
      {% set vim_keys = ['s', 'd', 'f', 'g', 'x', 'c', 'v', 'b', 'j', 'k'] %}
      {% for tid, tname in topics.items() %}
      {% set shortcut = tid if tid < 10 else '' %}
      {% set vim_shortcut = vim_keys[loop.index - 1] if loop.index - 1 < vim_keys|length else '' %}
      <tr data-topic-id="{{ tid }}" class="topic-row">
        <td class='topic_name'>
          <a href="{{ url_for('index.topic', tid=tid|int) }}" class="topic-link dflex ai-center">
            <span class="shortcut-key m5 r">{{ shortcut }}{{ '.' + vim_shortcut if vim_shortcut else '' }}:</span>
            {{ tname }}
          </a>
        </td>
        <td class='topic_stats'>
          {% set stat = stats | selectattr("topic_id", "equalto", tid) | first %}
          <div class='stats dflex row ai-center jc-between'>
            <div class="stats-left dflex row">
              {% for grade in ['F', 'D', 'C', 'B', 'A', 'N'] %}
                <span class="stat p5 {{ grade }}">{{ grade }}:{{ stat[grade] }}</span>
              {% endfor %}
            </div>
            <div class="stats-right dflex row">
              <span class="total p5">{{ stat.in_progress }}/{{ stat.total }}</span>
              <span id='suspicious' class="suspicious p5 {% if stat.get('suspicious', 0) == 0 %}zero{% else %}found{% endif %}">
                ?:{{ stat.get('suspicious', 0) }}
              </span>
            </div>
          </div>
          <div class="progress-bar">
              {% set total = stat.get('total', 1) %}
              {% for grade in ['F', 'D', 'C', 'B', 'A', 'N'] %}
                {% set width = (stat.get(grade, 0) / total * 100) if total else 0 %}
                <div class="sub-progress {{ grade }} {% if width == 0 %}dnone{% endif %}" 
                     style="width: {{ width }}%;">
                </div>
              {% endfor %}
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
