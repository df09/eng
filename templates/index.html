{% extends 'base.html' %}
{% block title %}Main Menu{% endblock %}
{% block header %}
  <span>MainMenu<span>
{% endblock %}
{% block content %}
<section class="topics">
  <table>
    <thead>
      <tr>
        <th class="p5">Topic</th>
        <th class="p5">Stats and Progress</th>
      </tr>
    </thead>
    <tbody>
      {% for tid, tname in topics.items() %}
      <tr>
        <td class='topic_name p5'><a href="{{ url_for('index.topic', tid=tid|int) }}">{{ tid }}.{{ tname }}</a></td>
        <td class='topic_stats p5'>
          {% set stat = stats | selectattr("topic_id", "equalto", tid) | first %}
          <div class='stats dflex row ai-center jc-between'>
            <div class="stats-left dflex row">
              {% for grade in ['F', 'D', 'C', 'B', 'A', 'N'] %}
                <span class="stat p5 {{ grade }}">{{ grade }}:{{ stat[grade] }}</span>
              {% endfor %}
            </div>
            <div class="stats-right dflex row">
              <span class="total p5">{{ stat.in_progress }}/{{ stat.total }}</span>
              <span id='suspicious' class="suspicious p5 {% if stat.get('suspicious', 0) == 0 %}zero{% else %}found{% endif %}">
                ?:{{ stat.get('suspicious', 0) }}
              </span>
            </div>
          </div>
          <div class="progress-bar">
              {% set total = stat.get('total', 1) %}
              {% for grade in ['F', 'D', 'C', 'B', 'A', 'N'] %}
                {% set width = (stat.get(grade, 0) / total * 100) if total else 0 %}
                <div class="sub-progress {{ grade }} {% if width == 0 %}dnone{% endif %}" 
                     style="width: {{ width }}%;">
                </div>
              {% endfor %}
          </div>
        </td>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
